<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Base Fragment</title>
</head>
<body>

    <header th:fragment="header">
        <nav>
            <div class="logo">
                <a href="/" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-utensils"></i> SiwRecipes
                </a>
            </div>

            <ul class="nav-links">
                <li><a href="/recipes">Ricette</a></li>
                <li><a href="#">Chef</a></li>
                <li><a href="#">Chi Siamo</a></li>
            </ul>

            <div class="auth-buttons">
                <div th:if="${#authentication == null || #authorization.expression('isAnonymous()')}" style="display: inline-block;">
                    <a href="/login" class="btn btn-login">Accedi</a>
                    <a href="/register" class="btn btn-register">Registrati</a>
                    <!-- Theme Toggle Button placed after Accedi/Registrati for anonymous users -->
                    <button id="theme-toggle" class="btn theme-toggle" style="border: 2px solid var(--nav-text); background: transparent; color: var(--nav-text); cursor: pointer;" title="Cambia tema" aria-label="Cambia tema">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
                <div th:unless="${#authentication == null || #authorization.expression('isAnonymous()')}" style="display: inline-block;">
                    <span class="user-greeting">Ciao, <span th:text="${currentUser != null ? currentUser.name : #authentication.name}">User</span>!</span>
                    <a th:if="${#authorization.expression('hasAuthority(''ADMIN'')')}" href="/admin/indexAdmin" class="btn btn-register" style="background-color: #e74c3c; border-color: #e74c3c;">Admin</a>
                    <a href="/profile" class="btn btn-register">Area Personale</a>
                    <a href="/logout" class="btn btn-login">Logout</a>
                    <!-- Theme Toggle Button placed after Logout for authenticated users -->
                    <button id="theme-toggle" class="btn theme-toggle" style="border: 2px solid var(--nav-text); background: transparent; color: var(--nav-text); cursor: pointer; margin-left: 10px;" title="Cambia tema" aria-label="Cambia tema">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </nav>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const toggleButton = document.getElementById('theme-toggle');
                if (!toggleButton) return; // Safety check
                
                const icon = toggleButton.querySelector('i');
                const htmlElement = document.documentElement;
                
                // Check saved preference
                const savedTheme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                // Apply theme immediately
                if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
                    htmlElement.setAttribute('data-theme', 'dark');
                    if(icon) {
                        icon.classList.remove('fa-moon');
                        icon.classList.add('fa-sun');
                    }
                }
                
                toggleButton.addEventListener('click', function() {
                    if (htmlElement.getAttribute('data-theme') === 'dark') {
                        htmlElement.removeAttribute('data-theme');
                        localStorage.setItem('theme', 'light');
                        if(icon) {
                            icon.classList.remove('fa-sun');
                            icon.classList.add('fa-moon');
                        }
                    } else {
                        htmlElement.setAttribute('data-theme', 'dark');
                        localStorage.setItem('theme', 'dark');
                        if(icon) {
                            icon.classList.remove('fa-moon');
                            icon.classList.add('fa-sun');
                        }
                    }
                });
            });
        </script>
    </header>

    <footer th:fragment="footer">
        <p>&copy; 2025 <strong>SiwRecipes</strong> &bull; Universit√† Roma Tre</p>
    </footer>

</body>
</html>